<!doctype html>
<html lang="en">
        <link href="bootstrap.min.css" rel="stylesheet">

<head>
  <meta charset="utf-8">
  <style>

    body {
        background-color: rgba(0, 0, 0, .9);    
    }

    .boundary {
      fill: none;
      stroke: #a5967e;
    }

    .arcs path {
    pointer-events: none;
    /* opacity: .6;*/
    fill: none;
    }

    .tooltip{ 
            background-color:rgba(240,240,240,0.5);
            margin: 10px;
            height: 50px;
            width: 90px;
            padding-top: 10px;
            -webkit-border-radius:10px;
            -moz-border-radius:10px;
            border-radius:10px;
            font-size: 0.7em;
            text-align:center;
        }

        .tooltip span{
            font-size:0.5em;
        }

        h2{
            font-family: 'Oxygen', sans-serif;
            font-size: 36px;
            text-align: center;
            color: #a5967e;
        }

        #source a:link{
            color:lightgrey; 
            position: relative;
            background-color:transparent; 
            text-decoration:none;
            font-size: 12px;
        }

        #source a:visited{
            color:lightgrey; 
            position:relative;
            background-color:transparent; 
            text-decoration:none;
        }

        #source a:hover{
            color:#a5967e; 
            background-color:transparent; 
            text-decoration:underline
        }
        #source a:active{
            color:#a5967e; background-color:transparent; text-decoration:underline
        }

        svg{
            position: relative;
            margin-top:20px;
            left:80px;
        }

        p{
            color:#a5967e; 
            font-size: 9px;
        }

        .germany{
            color:#a5967e; 
            font-size: 15px;
            font-weight: 200px;
        }

        .countrySearch {
            position: relative;
            width:500px;
        }

        .search {
            padding:8px 15px;
            background:rgba(50, 50, 50, 0.2);
            border:0px solid red;
        }

        .button {
            position:relative;
            padding:6px 15px;
            left:-8px;
            border:2px solid #a5967e;
            background-color:lightgrey;
            color:#fafafa;
        }

        .button:hover  {
            background-color:#fafafa;
            color:lightgrey;
        }


        * { -webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; }
#searchfuntion { -webkit-font-smoothing: antialiased; font-family: "Helvetica Neue", sans-serif; font-size: 100%; margin: 0 auto; max-width: 15em; padding-bottom: 3em;left:190px;position:relative; }
pre, code { background-color: rgba(0, 0, 0, 0.04); padding: 0.2em 0; margin: 0; font-size: 85%; border-radius: 3px; font-family: Consolas, Menlo, monospace; }
pre { white-space: pre-wrap; }

h2 { margin-top: 1em; padding-top: 1em; border-top: 2px solid #eee; }

li { margin-bottom: 0.5em; }

/* generic table styling */
table { border-collapse: collapse; width: 100%; }
/*.searchfuntion {
  height:150px;
  overflow:auto;  
  margin-top:20px;
}*/
th, td { padding: 5px; color:lightgrey;}
th { border-bottom: 2px solid #999; background-color: #eee; vertical-align: bottom; text-align: left; }
td { border-bottom: 1px solid #ccc; }


  </style>

</head>

<body>
    <h2> Where Refugees in Germany Come from? </h2>
    <div id="container"> 
    <div class="row">
        <div class="col-sm-8" id="map">
        </div>
        <div class="col-sm-4" id="searchfuntion"> 
        <!-- form class="countrySearch">
            <input class="search" type="text" placeholder="Search country..." required>
            <input class="button" type="button" value="Search">
        </form> -->
                <table>
                <thead>
                    <tr>
                        <th scope="col" title="Country">Country</th>
                        <th scope="col">Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>Afghanistan</td><td>539473</td></tr>
                    <tr><td>Albania</td><td>31183</td></tr>
                    <tr><td>Algeria</td><td>38782</td></tr>
                    <tr><td>Andorra</td><td>29</td></tr>
                    <tr><td>Angola</td><td>38874</td></tr>
                    <tr><td>Antigua and Barbuda</td><td>14</td></tr>
                    <tr><td>Argentina</td><td>517</td></tr>
                    <tr><td>Armenia</td><td>55610</td></tr>
                    <tr><td>Australia</td><td>348</td></tr>
                    <tr><td>Austria</td><td>275</td></tr>
                    <tr><td>Azerbaijan</td><td>93453</td></tr>
                    <tr><td>Bahamas</td><td>11</td></tr>
                    <tr><td>Bahrain</td><td>253</td></tr>
                    <tr><td>Bangladesh</td><td>12261</td></tr>
                    <tr><td>Barbados</td><td>40</td></tr>
                    <tr><td>Belarus</td><td>26789</td></tr>
                    <tr><td>Belgium</td><td>157</td></tr>
                    <tr><td>Belize</td><td>15</td></tr>
                    <tr><td>Benin</td><td>3180</td></tr>
                    <tr><td>Bhutan</td><td>1629</td></tr>
                    <tr><td>Bolivia (Plurinational State of)</td><td>525</td></tr>
                    <tr><td>Bosnia and Herzegovina</td><td>2022935</td></tr>
                    <tr><td>Botswana</td><td>58</td></tr>
                    <tr><td>Brazil</td><td>2980</td></tr>
                    <tr><td>British Virgin Islands</td><td>0</td></tr>
                    <tr><td>Brunei Darussalam</td><td>1</td></tr>
                    <tr><td>Bulgaria</td><td>8780</td></tr>
                    <tr><td>Burkina Faso</td><td>5076</td></tr>
                    <tr><td>Burundi</td><td>2378</td></tr>
                    <tr><td>Cabo Verde</td><td>78</td></tr>
                    <tr><td>Cambodia</td><td>2136</td></tr>
                    <tr><td>Cameroon</td><td>22821</td></tr>
                    <tr><td>Canada</td><td>1111</td></tr>
                    <tr><td>Central African Rep.</td><td>271</td></tr>
                    <tr><td>Chad</td><td>1206</td></tr>
                    <tr><td>Chile</td><td>6234</td></tr>
                    <tr><td>China</td><td>61504</td></tr>
                    <tr><td>China Hong Kong</td><td>0</td></tr>
                    <tr><td>C’‚te d'Ivoire</td><td>8511</td></tr>
                    <tr><td>Colombia</td><td>4340</td></tr>
                    <tr><td>Comoros</td><td>68</td></tr>
                    <tr><td>Congo</td><td>8745</td></tr>
                    <tr><td>Costa Rica</td><td>145</td></tr>
                    <tr><td>Croatia</td><td>67222</td></tr>
                    <tr><td>Cuba</td><td>5758</td></tr>
                    <tr><td>Cyprus</td><td>11</td></tr>
                    <tr><td>Czech Rep.</td><td>22442</td></tr>
                    <tr><td>Dem. People's Rep. of Korea</td><td>2845</td></tr>
                    <tr><td>Dem. Rep. of the Congo</td><td>74370</td></tr>
                    <tr><td>Denmark</td><td>37</td></tr>
                    <tr><td>Djibouti</td><td>85</td></tr>
                    <tr><td>Dominica</td><td>27</td></tr>
                    <tr><td>Dominican Rep.</td><td>786</td></tr>
                    <tr><td>Ecuador</td><td>1378</td></tr>
                    <tr><td>Egypt</td><td>17078</td></tr>
                    <tr><td>El Salvador</td><td>289</td></tr>
                    <tr><td>Equatorial Guinea</td><td>419</td></tr>
                    <tr><td>Eritrea</td><td>73227</td></tr>
                    <tr><td>Estonia</td><td>2941</td></tr>
                    <tr><td>Ethiopia</td><td>70431</td></tr>
                    <tr><td>Fiji</td><td>26</td></tr>
                    <tr><td>Finland</td><td>29</td></tr>
                    <tr><td>France</td><td>538</td></tr>
                    <tr><td>Gabon</td><td>232</td></tr>
                    <tr><td>Gambia</td><td>9230</td></tr>
                    <tr><td>Georgia</td><td>35195</td></tr>
                    <tr><td>Germany</td><td>102020</td></tr>
                    <tr><td>Ghana</td><td>38883</td></tr>
                    <tr><td>Greece</td><td>1196</td></tr>
                    <tr><td>Grenada</td><td>11</td></tr>
                    <tr><td>Guatemala</td><td>130</td></tr>
                    <tr><td>Guinea</td><td>15282</td></tr>
                    <tr><td>Guinea-Bissau</td><td>1361</td></tr>
                    <tr><td>Guyana</td><td>38</td></tr>
                    <tr><td>Haiti</td><td>472</td></tr>
                    <tr><td>Holy See (the)</td><td>2</td></tr>
                    <tr><td>Honduras</td><td>262</td></tr>
                    <tr><td>Hungary</td><td>14414</td></tr>
                    <tr><td>Iceland</td><td>76</td></tr>
                    <tr><td>India</td><td>43668</td></tr>
                    <tr><td>Indonesia</td><td>2020</td></tr>
                    <tr><td>Iran (Islamic Rep. of)</td><td>381893</td></tr>
                    <tr><td>Iraq</td><td>767051</td></tr>
                    <tr><td>Ireland</td><td>35</td></tr>
                    <tr><td>Israel</td><td>4569</td></tr>
                    <tr><td>Italy</td><td>1036</td></tr>
                    <tr><td>Jamaica</td><td>399</td></tr>
                    <tr><td>Japan</td><td>1687</td></tr>
                    <tr><td>Jordan</td><td>8758</td></tr>
                    <tr><td>Kazakhstan</td><td>29686</td></tr>
                    <tr><td>Kenya</td><td>5907</td></tr>
                    <tr><td>Kiribati</td><td>20</td></tr>
                    <tr><td>Kuwait</td><td>1245</td></tr>
                    <tr><td>Kyrgyzstan</td><td>18889</td></tr>
                    <tr><td>Lao People's Dem. Rep.</td><td>2713</td></tr>
                    <tr><td>Latvia</td><td>12102</td></tr>
                    <tr><td>Lebanon</td><td>157275</td></tr>
                    <tr><td>Lesotho</td><td>34</td></tr>
                    <tr><td>Liberia</td><td>6856</td></tr>
                    <tr><td>Libya</td><td>10264</td></tr>
                    <tr><td>Liechtenstein</td><td>1</td></tr>
                    <tr><td>Lithuania</td><td>6740</td></tr>
                    <tr><td>Luxembourg</td><td>10</td></tr>
                    <tr><td>Madagascar</td><td>149</td></tr>
                    <tr><td>Malawi</td><td>74</td></tr>
                    <tr><td>Malaysia</td><td>689</td></tr>
                    <tr><td>Maldives</td><td>10</td></tr>
                    <tr><td>Mali</td><td>2992</td></tr>
                    <tr><td>Malta</td><td>24</td></tr>
                    <tr><td>Mauritania</td><td>1003</td></tr>
                    <tr><td>Mauritius</td><td>127</td></tr>
                    <tr><td>Mexico</td><td>641</td></tr>
                    <tr><td>Monaco</td><td>6</td></tr>
                    <tr><td>Mongolia</td><td>3349</td></tr>
                    <tr><td>Montenegro</td><td>17193</td></tr>
                    <tr><td>Morocco</td><td>26598</td></tr>
                    <tr><td>Mozambique</td><td>1283</td></tr>
                    <tr><td>Myanmar</td><td>9562</td></tr>
                    <tr><td>Namibia</td><td>141</td></tr>
                    <tr><td>Nepal</td><td>5331</td></tr>
                    <tr><td>Netherlands</td><td>421</td></tr>
                    <tr><td>New Zealand</td><td>101</td></tr>
                    <tr><td>Nicaragua</td><td>123</td></tr>
                    <tr><td>Niger</td><td>3415</td></tr>
                    <tr><td>Nigeria</td><td>44783</td></tr>
                    <tr><td>Norway</td><td>36</td></tr>
                    <tr><td>Oman</td><td>274</td></tr>
                    <tr><td>Pakistan</td><td>119306</td></tr>
                    <tr><td>Palau</td><td>5</td></tr>
                    <tr><td>Palestinian</td><td>945</td></tr>
                    <tr><td>Panama</td><td>62</td></tr>
                    <tr><td>Papua New Guinea</td><td>9</td></tr>
                    <tr><td>Paraguay</td><td>217</td></tr>
                    <tr><td>Peru</td><td>3427</td></tr>
                    <tr><td>Philippines</td><td>3018</td></tr>
                    <tr><td>Poland</td><td>75757</td></tr>
                    <tr><td>Portugal</td><td>237</td></tr>
                    <tr><td>Qatar</td><td>511</td></tr>
                    <tr><td>Rep. of Korea</td><td>4307</td></tr>
                    <tr><td>Rep. of Moldova</td><td>48681</td></tr>
                    <tr><td>Romania</td><td>28836</td></tr>
                    <tr><td>Russian Federation</td><td>494510</td></tr>
                    <tr><td>Rwanda</td><td>4310</td></tr>
                    <tr><td>Saint Lucia</td><td>19</td></tr>
                    <tr><td>Saint Vincent and the Grenadines</td><td>6</td></tr>
                    <tr><td>Samoa</td><td>9</td></tr>
                    <tr><td>Sao Tome and Principe</td><td>14</td></tr>
                    <tr><td>Saudi Arabia</td><td>3178</td></tr>
                    <tr><td>Senegal</td><td>3809</td></tr>
                    <tr><td>Serbia and Kosovo (S/RES/1244 (1999))</td><td>1682646</td></tr>
                    <tr><td>Seychelles</td><td>43</td></tr>
                    <tr><td>Sierra Leone</td><td>15602</td></tr>
                    <tr><td>Singapore</td><td>216</td></tr>
                    <tr><td>Slovakia</td><td>2929</td></tr>
                    <tr><td>Slovenia</td><td>2348</td></tr>
                    <tr><td>Solomon Islands</td><td>0</td></tr>
                    <tr><td>Somalia</td><td>60414</td></tr>
                    <tr><td>South Africa</td><td>1276</td></tr>
                    <tr><td>South Sudan</td><td>133</td></tr>
                    <tr><td>Spain</td><td>2717</td></tr>
                    <tr><td>Sri Lanka</td><td>145208</td></tr>
                    <tr><td>Stateless</td><td>431934</td></tr>
                    <tr><td>Sudan</td><td>12583</td></tr>
                    <tr><td>Suriname</td><td>13</td></tr>
                    <tr><td>Swaziland</td><td>11</td></tr>
                    <tr><td>Sweden</td><td>151</td></tr>
                    <tr><td>Switzerland</td><td>122</td></tr>
                    <tr><td>Syrian Arab Rep.</td><td>256993</td></tr>
                    <tr><td>Tajikistan</td><td>3126</td></tr>
                    <tr><td>Thailand</td><td>8213</td></tr>
                    <tr><td>The former Yugoslav Republic of Macedonia</td><td>80424</td></tr>
                    <tr><td>Togo</td><td>58316</td></tr>
                    <tr><td>Tonga</td><td>34</td></tr>
                    <tr><td>Trinidad and Tobago</td><td>90</td></tr>
                    <tr><td>Tunisia</td><td>13523</td></tr>
                    <tr><td>Turkey</td><td>1537693</td></tr>
                    <tr><td>Turkmenistan</td><td>4371</td></tr>
                    <tr><td>Tuvalu</td><td>7</td></tr>
                    <tr><td>Uganda</td><td>4417</td></tr>
                    <tr><td>Ukraine</td><td>365926</td></tr>
                    <tr><td>United Arab Emirates</td><td>2434</td></tr>
                    <tr><td>United Kingdom</td><td>299</td></tr>
                    <tr><td>United Rep. of Tanzania</td><td>576</td></tr>
                    <tr><td>United States of America</td><td>3810</td></tr>
                    <tr><td>Uruguay</td><td>150</td></tr>
                    <tr><td>Uzbekistan</td><td>26975</td></tr>
                    <tr><td>Venezuela (Bolivarian Republic of)</td><td>606</td></tr>
                    <tr><td>Viet Nam</td><td>253723</td></tr>
                    <tr><td>Yemen</td><td>5490</td></tr>
                    <tr><td>Zambia</td><td>194</td></tr>
                    <tr><td>Zimbabwe</td><td>1292</td></tr>
                </tbody>
            </table>
            <p><em>Data as of December, 2014.</em></p>
        </div>
    </div>
</div>



    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/topojson.v0.min.js"></script>
    <script src="country_refugee.js"></script>
    <script src="js/d3tooltip.js"></script>
    <script src="js/jquery.js"></script>
    <script src="js/jquery.filtertable.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <link href='https://fonts.googleapis.com/css?family=Oxygen:400,300' rel='stylesheet' type='text/css'>


    <script>
        var width = 900,
            height = 450;

        var svg = d3.select("#map").append("svg")
            .attr("width", width)
            .attr("height", height);

        var projection = d3.geo.equirectangular()
            .scale(153)
            .translate([width/2,height/2])


        var path = d3.geo.path()
            .projection(projection);

        d3.json("https://gist.githubusercontent.com/abenrob/787723ca91772591b47e/raw/8a7f176072d508218e120773943b595c998991be/world-50m.json", function(error, world) {
            svg.append("g")
                .attr("class", "land")
                .selectAll("path")
                .data([topojson.object(world, world.objects.land)])
                .enter().append("path")
                .attr("d", path);
            svg.append("g")
                .attr("class", "boundary")
                .selectAll("boundary")
                .data([topojson.object(world, world.objects.countries)])
                .enter().append("path")
                .attr("d", path);

// draw the curves between each country and Germany
        var arcs = svg.append("g")
            .attr("class", "arcs");

        var line = arcs.selectAll("path")
            .data(arcdata)
            .enter()
            .append("path")
            .style("opacity", 0.5)
            .attr("d", function(d) {
                return lngLatToArc(d, 'sourceLocation', 'targetLocation', 15);
            })
            .style("stroke", function(d, i) {
                return "url(#line-gradient" + i + ")";
            });


        var gradient = svg.selectAll("linearGradient")
            .data(arcdata)
            .enter()
            .append("linearGradient")
            .attr("id", function(d, i) {
                return "line-gradient" + i;
            })
            .attr("gradientUnits", "userSpaceOnUse")
            .attr("color","lightgrey");

        gradient.append("stop")
            .attr("offset", "0%")
            .attr("stop-color", "lightgrey");

        gradient.append("stop")
            .attr("offset", function(d, i) {
                return arcdata[i].gradient[0].offset;
            })
            .attr("stop-color", "lightgrey");


// add points to origin countries 
        svg.selectAll("point")
            .data(arcdata)
            .enter()
            .append("circle")
            .attr("class", "cityCircle")
            .attr("r", 4)
            .style("fill", "lightgrey")
            .style("stroke-width", 1)
            .style("opacity",0.8)
            .attr("cursor", "default")
            .attr("transform", function(d, i) {
                return "translate(" + projection([arcdata[i].sourceLocation[0], arcdata[i].sourceLocation[1]]) + ")";
            })
            .call(d3.helper.tooltip(
                            function(d, i){
                              return "<b>"+d.country +"</b>"+"<br/>"+"<span>Number of Refugees: </span>"+ "<b>"+d.total;
                            }
                        ))
            .on("mouseenter", function(d) {
              d3.select(this).attr("r", 10).style("fill", "#a5967e");
            })                  
            .on("mouseleave", function(d) {
              d3.select(this).attr("r", 4).style("fill", "#fff8ee");
            })

//draw Germany point
        svg.append("text")
            .attr("class", "germany")
            .attr("cursor", "default")
            .text("Germany")
            .style("fill", "lightgrey")
            .style("font-size", 11)
            .attr("text-anchor", "middle")
            .attr("transform", "translate(" + projection([4.3833,62.5167]) + ")");

        svg.append("circle")
            .attr("class", "germany")
            .attr("cursor", "default")
            .style("fill", "#a5967e")
            .style("opacity",0.8)
            .attr("r", 12)
            .attr("transform", "translate(" + projection([13.3833,52.5167]) + ")");

        // svg.append("svg:image")
        //     .attr("class","icon")
        //     .attr('width', 80)
        //     .attr('height', 80)
        //     .attr("xlink:href","resource/icon.svg")
        //     .attr("transform", "translate(" + projection([-1,74.5167]) + ")")
        //     .style("fill", "#a5967e");



// MOVE THE DOTS   
        function moveDots() {
            for (var i = 0; i < 28; i++) {
                k = svg.append("path")
                    .style("stroke", "none")
                    .style("fill", "none")
                    .attr("class", "ghostpath")
                    .attr("d", function(d) {
                        return lngLatToArc(arcdata[i], 'sourceLocation', 'targetLocation', 1);
                    });

                l = svg.selectAll(".point")
                    .data(arcdata[i].byTime)
                    .enter()
                    .append("circle")
                    .attr("class", "movingpts")
                    .attr("r", 3)
                    .style("fill", "lightgrey")
                    .style("opacity", 0);


                transformLine = translateAlong(k.node());

                l.transition()
                    .delay(function(d, i) {
                        return i * 300;
                    })
                    .duration(4000)
                    .style("opacity", 1)
                    .attrTween("transform", transformLine)
                    .each("end", function() {
                        d3.select(this)
                            .remove();
                        d3.selectAll(".ghostpath")
                            .remove()
                    })
            }
        }

        moveDots();


        function type(d) {
            d.total = +d.total;
            return d;
        }          
        });

   
        // Returns an attrTween for translating along the specified path element.
        function translateAlong(path) {
            var l = path.getTotalLength();
            return function(d, i, a) {
                return function(t) {
                    var p = path.getPointAtLength((1 - t) * l);
                    return "translate(" + p.x + "," + p.y + ")";
                };
            };
        }

   
    function lngLatToArc(d, sourceName, targetName, bend) {
        bend = .7;

        var sourceLngLat = d[sourceName],
            targetLngLat = d[targetName];
        if (targetLngLat && sourceLngLat) {
            var sourceXY = projection(sourceLngLat),
                targetXY = projection(targetLngLat);
            var sourceX = sourceXY[0],
                sourceY = sourceXY[1];
            var targetX = targetXY[0],
                targetY = targetXY[1];
            var dx = (targetX - sourceX),
                dy = targetY - sourceY,
                dr = Math.sqrt(dx * dx + dy * dy) * bend;
            return "M" + targetX + "," + targetY + "A" + dr + "," + dr + " 0 0,1 " + sourceX + "," + sourceY;
            return "M" + sourceX + "," + sourceY + "A" + dr + "," + dr + " 0 0,1 " + targetX + "," + targetY;

        }
    }

    // function contains(text_one, text_two){
    //     if (text_one.indexof(text_two) != -1)
    //         return true;
    // }

    // $("#searchText").keyup(function(){
    //     var searchText =$("#searchText").val().toLowerCase()
    //     $("").each(function(){
    //         if (!contains($(this).text().toLowerCase(),searchText))
    //             $(this).hide();
    //         else
    //             $(this).show();
    //     });
    // });

    $(document).ready(function() {
        // apply filterTable to all tables on this page
        $('table').filterTable({filterExpression: 'filterTableFindAll'});
    });

    </script>
    <div id="source">
        <span>
            <a href="http://popstats.unhcr.org/en/time_series"> Source:Extracted from the UNHCR Population Statistics Reference Database</a>
        </span>
        <p>(Note: In the 2014 data, figures between 1 and 4 have been replaced with an asterisk (*). These represent situations where the figures are being kept confidential to protect the anonymity of individuals. Such figures are not included in any totals.)</p>
    </div>
</body>
</html>